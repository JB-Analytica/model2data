// SaaS Multi-Tenant Platform Schema
// Showcases: Multi-tenant isolation, Faker data types, min/max constraints for numeric fields
// Example: model2data generate --file examples/saas_platform.dbml --rows 20 --seed 42

Table organizations {
  id bigint [pk, not null]
  name company [not null]
  slug slug [unique, not null]
  is_active boolean [default: true]
  created_at timestamp [not null]

  Note {
    'Organization (tenant) root entity. Data types: company, slug'
  }
}

Table users {
  id bigint [pk, not null]
  organization_id bigint [not null]
  email email [not null]
  first_name first_name [not null]
  last_name last_name [not null]
  role user_name

  Note {
    'Users belong to organization. Data types: email, first_name, last_name, user_name'
  }
}

Table subscriptions {
  id bigint [pk, not null]
  organization_id bigint [not null]
  plan_tier text [not null]
  monthly_price numeric [not null]
  status text
  current_period_start timestamp [not null]
  current_period_end timestamp

  Note {
    'Plan tiers: free, starter, pro, enterprise'
  }
}

Table invoices {
  id bigint [pk, not null]
  organization_id bigint [not null]
  subscription_id bigint [not null]
  amount numeric [not null]
  status text
  created_at timestamp [not null]

  Note {
    'Invoice tracking. status: draft, paid, overdue'
  }
}

Table feature_limits {
  id bigint [pk, not null]
  organization_id bigint [not null]
  api_calls_monthly int [not null]
  storage_gb int [not null]
  users_allowed int [not null]

  Note {
    'Feature limits per organization. Varies by plan tier'
  }
}

Table api_usage {
  id bigint [pk, not null]
  organization_id bigint [not null]
  month int [not null]
  api_calls_used int [not null]

  Note {
    'API usage tracking. month: 1-12'
    'min': 1,
    'max': 12
  }
}

Table audit_events {
  id bigint [pk, not null]
  organization_id bigint [not null]
  user_id bigint
  event_type text [not null]
  resource_id text
  resource_type text
  created_at timestamp [not null]

  Note {
    'Audit log: what changed, who did it, when. Data types used: text (fallback for unknown types)'
  }
}

Ref {
  users.organization_id > organizations.id
}

Ref {
  subscriptions.organization_id > organizations.id
}

Ref {
  invoices.organization_id > organizations.id
}

Ref {
  invoices.subscription_id > subscriptions.id
}

Ref {
  feature_limits.organization_id > organizations.id
}

Ref {
  api_usage.organization_id > organizations.id
}

Ref {
  audit_events.organization_id > organizations.id
}

Ref {
  audit_events.user_id > users.id
}
